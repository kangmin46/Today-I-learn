# 운영체제 구조

* CPU Protection Rings
    * CPU도 권한모드라는 것을 가지고 있다. 
        * User Mode(사용자 모드) : 응용 프로그램이 사용
        * 커널 모드(Kernal mode) : 특권 명령어 실행과 원하는 작업 수행을 위한 자원 접근을 가능케 하는 모드, 운영체제가 cpu자원을 사용하는 모드 

*  응용프로그램 (사용자 영역)-> API (사용자 영역)-> 시스템 호출 인터페이스 (커널 영역)

ex) 
1단계 : 1~1000까지 더한다. 
2단계 : 파일에서 데이터를 가져온다. (커널 영역이 실행이 된다.)
3단계 : 해당 데이터와 1~1000 더한 값을 더한다. 출력한다. 

* 시스템콜은 커널 모드로 실행
    * 커널 모드에서만 실행 가능한 기능들이 있음.
    * 커널 모드로 실행하려면, 반드시 시스템 콜을 사용해야 함.(거쳐야 함)
    * 시스템 콜은 운영체제가 제공
* 응용 프로그램에서 강제로 CPU를 사용할 수 없다. 
* 반드시 시스템 콜을 거쳐야 한다.

* 사용자 모드와 커널 모드
    * 함부로 응용 프로그램이 전체 컴퓨터 시스템을 해치지 못함.
    * 주민등록등본은 꼭 동사무소 또는 민원24시 에서 특별한 신청서를 써야만 발급받을 수 있다. 
        * 동사무소 직원은 특별한 권한을 가지고, 주민등록등본 출력 명령을 실행
* 시스템 프로그래머 : shell, API, System call을 구현

```
int main()
{
    int fd;
    fd = open("data.txt".O_ROONLY);
        1. 사용자 모드에서 프로그램 실행
        2. open() 시스템 콜 호출
        3. 커널 모드로 전환
        4. open() 함수를 처리하는 sys_open() 커널 함수 호출
        5. 파일 열기로 레벨 연산 수행
        6. 사용자 모드로 전환
    if(fd == -1){

    }
}
```
유저모드   API 
   --  System call -- 
커널모드 System call을 처리하는 운영체제 함수

정리
    * 운영체제는 시스템 콜을 제공
    * 프로그래밍 언어별로 운영체제 기능을 활용하기 위해, 시스템 콜을 기반으로 **API** 를 제공
    * 응용 프로그램은 운영체제 기능 필요시, 해당 API 를 사용해서 프로그램을 작성하는 것 
    * 응용 프로그램이 실행되서, 운영체제 기능이 필요한 **API**를 호출하면 시스템 콜이 호출되서, 커널 모드로 변경되어 OS내부에서 해당 명령이 실행되고, 
    다시 응용 프로그램으로 돌아간다. 
