# TCP / IP 에서 데이터를 주고 받을 때

* MTU : 한 패킷으로 운반할 수 있는 데이터의 최대 길이 (데이터 + TCP헤더 + IP 헤더)
* MSS : 한 해킷으로 운반할 수 있는 데이터의 길이 

* 프로토콜 스택에는 타이머가 있어서 시간이 지나면 패킷을 전송한다. 
* 패킷을 전송할 떄에는 MTU와 타이밍을 잘 계산해서 전송해야 한다. 
* MTU가 높으면 데이터를 모아두고 한번에 쏘기 때문에 송신동작이 지연될 우려가 있고 너무 자주보내면 네트워크 비용이 많이 든다.
* 데이터를 송신할 떄에 시퀀스 번호를 매겨서 보낸다.
* 첫 시퀀스 번호는 난수로 한다. 그 이유는 시퀀스번호 초기값을 누가 알게되면 악용되기 때문
* 두번쨰 시퀀스 번호는 첫번째 시퀀스번호의 난수 + 데이터의 크기 + 1 이다.
* SYN을 할 떄에 시퀀스 초기 값을 보낸다.
* 네트워크 상황에 따라서 ACK가 돌아오는 시간이 다 다르다.
* TCP는 패킷 평균 왕복 시간으로 ACK 대기시간을 알아서 조정한다.

- 클라이언트에서 서버까지의 흐름
    1. 브라우저는 리퀘스트 메시지를 프로토콜 스택에게 의뢰한다.
    2. 처음 데이터를 보내고 첫 응답을 받기 전까지는 수신버퍼에 아무것도 없어서 할 일이 없다.
    3. 응답 데이터가 도착하면 수신 버퍼의 내용을 읽어본다.
    4. TCP 시퀀스번호등을 확인해서 도중에 누락된 데이터가 없는지를 검사한다.
    5. 그리고 데이터를 하나로 합쳐 애플리케이션 으로 전달해 준다.
    6. 그리고 서버에 ACK를 전송하며 마무리한다.

 IP와 이더넷의 패킷 송 * 수신 동작

- MAC헤더는 서브넷에서 이동할 때 사용 되는 것이다.
- IP헤더는 그외의 구간에서 이동할 때에 사용 되는 것이다.
- 클라이언트에서 제일 가까운 라우터에 대한 정보를 MAC헤더에 기록한다. 예를들어 R1이라고 하자
- 그러면 서브넷에 있는 허브에게 간다. 만약 복수라면 허브를 순차적으로 경유한다.
- 허브는 MAC 헤더와 자신이 기록하고 있는 표랑 같이 모아서 목적지를 판단해서 중계한다.
- 패킷이 다음 라우터에 도착한다.
- 라우터에는 IP 용 표가 있으므로 이것을  IP헤더가 읽어서 어느 라우터에 패킷을 중계하면 좋을지를 결정한다.
- 그리고 다음 라우터의 목적지를 알아야 되니까 MAC헤더에 다시 기록한다.
- 그렇기 떄문에 MAC헤더는 계속 업데이트 되는 꼴이다.
- 역할을 분담하는 이유 : 이더넷 같은 것은 다른 것으로 대체 될 수가 있다. (무선  LAN, ADSL 등) 그래서 유연성이 필요하다.
- 하나의 PC에 LAN 어댑터는 여러개가 될 수 있다.
- IP주소 할당은 LAN 어댑터 별로 부여가 되기 떄문에 하나의 PC가 여러개의 IP를 가질 수 있다!!
- 송신처의 IP주소는 송신처가 되는 LAN 어댑터를 판단하여 주소를 설정한다.
- MAC 주소는 48비트
- MAC주소도 송신처와 수신처가 존재하는 데, 수신처는 'Gateway' 항목에 기록되어 있는 IP주소의 기기가 패킷을 건네줄 상대가 된다.
- 여기서 사용되는 것이 'ARP' 인데 이더넷에 연결되어 있는 전원에게 패킷을 전달하는 브로드캐스트 구조가 있으며 이 구조를 이용하여 "00 라는 IP주소를 가지고 있는 분 있습니까?" 라고 물어보면 해당자가"저요! 제 MAC주소는 XXXX입니다" 라고 응답을 해준다.
- 브로드 캐스트로 조사하게 되면 ARP는 ARP 캐시를 이용해 메모리 영역에 보존하여 다시 이용한다.
- MAC 주소를 사용할 때에는 ARP를 사용한다.

